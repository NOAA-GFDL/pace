from dataclasses import dataclass

import numpy as np


@dataclass
class HybridPressureCoefficients:
    """
    Attributes:
     - ks: The number of pure-pressure layers at the top of the model
        Also the level where model transitions from pure pressure to
        hybrid pressure levels
     - ptop: The pressure at the top of the atmosphere
     - ak: The additive coefficient in the pressure calculation
     - bk: The multiplicative coefficient in the pressure calculation
    """

    ks: int
    ptop: int
    ak: np.ndarray
    bk: np.ndarray


def set_hybrid_pressure_coefficients(km: int) -> HybridPressureCoefficients:
    """
    Sets the coefficients describing the hybrid pressure coordinates.

    The pressure of each k-level is calculated as Pk = ak + (bk * Ps)
    where Ps is the surface pressure. Values are currently stored in
    lookup tables.

    Args:
        km: The number of vertical levels in the model

    Returns:
        a HybridPressureCoefficients dataclass
    """
    if km == 79:
        ak = np.array(
            [
                300,
                646.7159,
                1045.222,
                1469.188,
                1897.829,
                2325.385,
                2754.396,
                3191.294,
                3648.332,
                4135.675,
                4668.282,
                5247.94,
                5876.271,
                6554.716,
                7284.521,
                8066.738,
                8902.188,
                9791.482,
                10734.99,
                11626.25,
                12372.12,
                12990.41,
                13496.29,
                13902.77,
                14220.98,
                14460.58,
                14629.93,
                14736.33,
                14786.17,
                14785.11,
                14738.12,
                14649.66,
                14523.7,
                14363.82,
                14173.24,
                13954.91,
                13711.48,
                13445.4,
                13158.9,
                12854.07,
                12532.8,
                12196.85,
                11847.88,
                11487.39,
                11116.82,
                10737.48,
                10350.62,
                9957.395,
                9558.875,
                9156.069,
                8749.922,
                8341.315,
                7931.065,
                7519.942,
                7108.648,
                6698.281,
                6290.007,
                5884.984,
                5484.372,
                5089.319,
                4700.96,
                4320.421,
                3948.807,
                3587.201,
                3236.666,
                2898.237,
                2572.912,
                2261.667,
                1965.424,
                1685.079,
                1421.479,
                1175.419,
                947.6516,
                738.8688,
                549.713,
                380.7626,
                232.5417,
                105.481,
                -0.0008381903,
                0,
            ]
        )
        bk = np.array(
            [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0.001065947,
                0.004128662,
                0.009006631,
                0.01554263,
                0.02359921,
                0.03305481,
                0.0438012,
                0.05574095,
                0.06878554,
                0.08285347,
                0.09786981,
                0.1137643,
                0.130471,
                0.1479275,
                0.1660746,
                0.1848558,
                0.2042166,
                0.2241053,
                0.2444716,
                0.2652672,
                0.286445,
                0.3079604,
                0.3297701,
                0.351832,
                0.3741062,
                0.3965532,
                0.4191364,
                0.4418194,
                0.4645682,
                0.48735,
                0.5101338,
                0.5328897,
                0.5555894,
                0.5782067,
                0.6007158,
                0.6230936,
                0.6452944,
                0.6672683,
                0.6889648,
                0.7103333,
                0.7313231,
                0.7518838,
                0.7719651,
                0.7915173,
                0.8104913,
                0.828839,
                0.846513,
                0.8634676,
                0.8796583,
                0.8950421,
                0.9095779,
                0.9232264,
                0.9359506,
                0.9477157,
                0.9584892,
                0.9682413,
                0.9769447,
                0.9845753,
                0.9911126,
                0.9965372,
                1,
            ]
        )

    elif km == 91:
        ak = np.array(
            [
                1.00000000,
                1.75000000,
                2.75000000,
                4.09999990,
                5.98951054,
                8.62932968,
                12.2572632,
                17.1510906,
                23.6545467,
                32.1627693,
                43.1310921,
                57.1100426,
                74.6595764,
                96.4470978,
                123.169769,
                155.601318,
                194.594009,
                241.047531,
                295.873840,
                360.046967,
                434.604828,
                520.628723,
                619.154846,
                731.296021,
                858.240906,
                1001.06561,
                1160.92859,
                1339.03992,
                1536.50012,
                1754.48938,
                1994.17834,
                2256.67407,
                2543.17139,
                2854.76392,
                3192.58569,
                3557.75366,
                3951.35107,
                4374.28662,
                4827.11084,
                5310.22168,
                5823.87793,
                6369.04248,
                6948.75244,
                7566.91992,
                8226.34277,
                8931.20996,
                9684.46191,
                10482.2725,
                11318.2793,
                12184.0771,
                13065.5674,
                13953.2207,
                14830.7285,
                15687.2617,
                16508.0645,
                17281.0996,
                17994.2988,
                18636.3223,
                19196.1797,
                19664.0723,
                20030.1914,
                20285.3691,
                20421.5254,
                20430.0684,
                20302.8730,
                20032.3711,
                19611.0664,
                19031.3848,
                18286.6426,
                17377.7930,
                16322.4639,
                15144.4033,
                13872.5674,
                12540.4785,
                11183.4170,
                9835.32715,
                8526.30664,
                7282.24512,
                6123.26074,
                5063.50684,
                4111.24902,
                3270.00122,
                2539.22729,
                1915.30762,
                1392.44995,
                963.134766,
                620.599365,
                357.989502,
                169.421387,
                51.0314941,
                2.48413086,
                0.00000000,
            ]
        )

        bk = np.array(
            [
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                3.50123992e-06,
                2.81484008e-05,
                9.38666999e-05,
                2.28561999e-04,
                5.12343016e-04,
                1.04712998e-03,
                1.95625005e-03,
                3.42317997e-03,
                5.58632007e-03,
                8.65428988e-03,
                1.27844000e-02,
                1.81719996e-02,
                2.49934997e-02,
                3.34198996e-02,
                4.36249003e-02,
                5.57769015e-02,
                7.00351968e-02,
                8.65636021e-02,
                0.105520003,
                0.127051994,
                0.151319996,
                0.178477004,
                0.208675995,
                0.242069006,
                0.278813988,
                0.319043010,
                0.362558991,
                0.408596009,
                0.456384987,
                0.505111992,
                0.553902984,
                0.601903021,
                0.648333013,
                0.692534983,
                0.733981013,
                0.772292018,
                0.807236016,
                0.838724971,
                0.866774976,
                0.891497016,
                0.913065016,
                0.931702971,
                0.947658002,
                0.961175978,
                0.972495019,
                0.981844008,
                0.989410996,
                0.995342016,
                1.00000000,
            ]
        )

    elif km == 72:
        ak = np.array(
            [
                1.00000000,
                2.00000024,
                3.27000046,
                4.75850105,
                6.60000134,
                8.93450165,
                11.9703016,
                15.9495029,
                21.1349030,
                27.8526058,
                36.5041084,
                47.5806084,
                61.6779099,
                79.5134125,
                101.944023,
                130.051025,
                165.079025,
                208.497040,
                262.021057,
                327.643066,
                407.657104,
                504.680115,
                621.680115,
                761.984192,
                929.294189,
                1127.69019,
                1364.34021,
                1645.71033,
                1979.16040,
                2373.04053,
                2836.78052,
                3381.00073,
                4017.54102,
                4764.39111,
                5638.79102,
                6660.34131,
                7851.23145,
                9236.57227,
                10866.3018,
                12783.7031,
                15039.3027,
                17693.0039,
                20119.2012,
                21686.5020,
                22436.3008,
                22389.8008,
                21877.5977,
                21214.9980,
                20325.8984,
                19309.6953,
                18161.8965,
                16960.8965,
                15625.9961,
                14290.9951,
                12869.5938,
                11895.8623,
                10918.1709,
                9936.52148,
                8909.99219,
                7883.42188,
                7062.19824,
                6436.26367,
                5805.32129,
                5169.61084,
                4533.90088,
                3898.20093,
                3257.08081,
                2609.20068,
                1961.31055,
                1313.48035,
                659.375244,
                4.80482578,
                0.00000000,
            ]
        )

        bk = np.array(
            [
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                8.17541324e-09,
                6.96002459e-03,
                2.80100405e-02,
                6.37200624e-02,
                0.113602079,
                0.156224087,
                0.200350106,
                0.246741116,
                0.294403106,
                0.343381137,
                0.392891139,
                0.443740189,
                0.494590193,
                0.546304166,
                0.581041515,
                0.615818441,
                0.650634944,
                0.685899913,
                0.721165955,
                0.749378204,
                0.770637512,
                0.791946948,
                0.813303947,
                0.834660947,
                0.856018007,
                0.877429008,
                0.898908019,
                0.920387030,
                0.941865027,
                0.963406026,
                0.984951973,
                1.00000000,
            ]
        )

    elif km == 137:
        ak = np.array(
            [
                1.00000000,
                1.82500005,
                3.00000000,
                4.63000011,
                6.82797718,
                9.74696636,
                13.6054239,
                18.6089306,
                24.9857178,
                32.9857101,
                42.8792419,
                54.9554634,
                69.5205765,
                86.8958817,
                107.415741,
                131.425507,
                159.279404,
                191.338562,
                227.968948,
                269.539581,
                316.420746,
                368.982361,
                427.592499,
                492.616028,
                564.413452,
                643.339905,
                729.744141,
                823.967834,
                926.344910,
                1037.20117,
                1156.85364,
                1285.61035,
                1423.77014,
                1571.62292,
                1729.44897,
                1897.51929,
                2076.09595,
                2265.43164,
                2465.77051,
                2677.34814,
                2900.39136,
                3135.11938,
                3381.74365,
                3640.46826,
                3911.49048,
                4194.93066,
                4490.81738,
                4799.14941,
                5119.89502,
                5452.99072,
                5798.34473,
                6156.07422,
                6526.94678,
                6911.87061,
                7311.86914,
                7727.41211,
                8159.35400,
                8608.52539,
                9076.40039,
                9562.68262,
                10065.9785,
                10584.6318,
                11116.6621,
                11660.0674,
                12211.5479,
                12766.8730,
                13324.6689,
                13881.3311,
                14432.1396,
                14975.6152,
                15508.2568,
                16026.1152,
                16527.3223,
                17008.7891,
                17467.6133,
                17901.6211,
                18308.4336,
                18685.7188,
                19031.2891,
                19343.5117,
                19620.0430,
                19859.3906,
                20059.9316,
                20219.6641,
                20337.8633,
                20412.3086,
                20442.0781,
                20425.7188,
                20361.8164,
                20249.5117,
                20087.0859,
                19874.0254,
                19608.5723,
                19290.2266,
                18917.4609,
                18489.7070,
                18006.9258,
                17471.8398,
                16888.6875,
                16262.0469,
                15596.6953,
                14898.4531,
                14173.3242,
                13427.7695,
                12668.2578,
                11901.3398,
                11133.3047,
                10370.1758,
                9617.51562,
                8880.45312,
                8163.37500,
                7470.34375,
                6804.42188,
                6168.53125,
                5564.38281,
                4993.79688,
                4457.37500,
                3955.96094,
                3489.23438,
                3057.26562,
                2659.14062,
                2294.24219,
                1961.50000,
                1659.47656,
                1387.54688,
                1143.25000,
                926.507812,
                734.992188,
                568.062500,
                424.414062,
                302.476562,
                202.484375,
                122.101562,
                62.7812500,
                22.8359375,
                3.75781298,
                0.00000000,
                0.00000000,
            ]
        )

        bk = np.array(
            [
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                0.00000000,
                7.00000010e-06,
                2.40000008e-05,
                5.90000018e-05,
                1.12000002e-04,
                1.99000002e-04,
                3.39999999e-04,
                5.61999972e-04,
                8.90000025e-04,
                1.35300006e-03,
                1.99200003e-03,
                2.85700010e-03,
                3.97100020e-03,
                5.37799997e-03,
                7.13300006e-03,
                9.26099997e-03,
                1.18060000e-02,
                1.48160001e-02,
                1.83179993e-02,
                2.23549996e-02,
                2.69639995e-02,
                3.21759991e-02,
                3.80260013e-02,
                4.45480011e-02,
                5.17730005e-02,
                5.97280003e-02,
                6.84479997e-02,
                7.79580027e-02,
                8.82859975e-02,
                9.94620025e-02,
                0.111505002,
                0.124448001,
                0.138312995,
                0.153125003,
                0.168909997,
                0.185689002,
                0.203491002,
                0.222332999,
                0.242244005,
                0.263242006,
                0.285353988,
                0.308598012,
                0.332938999,
                0.358253986,
                0.384362996,
                0.411125004,
                0.438391000,
                0.466003001,
                0.493800014,
                0.521619022,
                0.549301028,
                0.576691985,
                0.603648007,
                0.630035996,
                0.655736029,
                0.680643022,
                0.704668999,
                0.727738976,
                0.749796987,
                0.770798028,
                0.790717006,
                0.809535980,
                0.827256024,
                0.843881011,
                0.859431982,
                0.873929024,
                0.887408018,
                0.899900019,
                0.911448002,
                0.922096014,
                0.931881011,
                0.940859973,
                0.949064016,
                0.956550002,
                0.963352025,
                0.969512999,
                0.975077987,
                0.980072021,
                0.984542012,
                0.988499999,
                0.991984010,
                0.995002985,
                0.997630000,
                1.00000000,
            ]
        )

    else:
        raise NotImplementedError(
            "Only grids with 72, 79, 91 or 137 vertical levels"
            "have been implemented so far"
        )

    if 0.0 in bk:
        ks = 0 if km == 91 else np.where(bk == 0)[0][-1]
        ptop = ak[0]
    else:
        raise ValueError("bk must contain at least one 0.")

    pressure_data = HybridPressureCoefficients(ks, ptop, ak, bk)
    return pressure_data
